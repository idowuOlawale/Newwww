<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CampusPay - Fast P2P Payments on Sui</title>
  <!-- Official Mysten Wallet Kit CDN -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@mysten/wallet-kit@latest/dist/index.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mysten/wallet-kit@latest/dist/style.css">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #0f172a, #1e293b); color: #e2e8f0; margin: 0; padding: 0; min-height: 100vh; }
    header { background: #0ea5e9; padding: 20px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    .logo-container { display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap; }
    .logo-container img { height: 60px; border-radius: 12px; }
    h1 { margin: 0; font-size: 2.2rem; color: white; }
    .school { font-size: 1rem; color: #cffafe; margin-top: 8px; }
    main { max-width: 600px; margin: 40px auto; padding: 20px; background: #1e293b; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    section { margin-bottom: 30px; padding: 20px; background: #334155; border-radius: 12px; }
    h2 { color: #0ea5e9; border-bottom: 2px solid #0ea5e9; padding-bottom: 8px; }
    input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; font-size: 1rem; }
    input { background: #475569; color: white; }
    button { background: #0ea5e9; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
    button:hover { background: #0284c7; }
    .connected { color: #86efac; font-weight: bold; margin: 15px 0; }
    .share-link { word-break: break-all; background: #1e293b; padding: 10px; border-radius: 8px; margin-top: 10px; }
    footer { text-align: center; padding: 20px; color: #94a3b8; font-size: 0.9rem; }
    .powered-by { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 20px; }
    .powered-by img { height: 30px; }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="https://www.shutterstock.com/image-illustration/blue-digital-money-logo-line-260nw-2284351301.jpg" alt="CampusPay Logo">
      <div>
        <h1>CampusPay</h1>
        <p class="school">Built by a LASUSTECH Student â€¢ Sui Campus Hackathon 2025</p>
      </div>
      <img src="https://cryptologos.cc/logos/sui-sui-logo.png" alt="Sui Logo" style="height: 50px;">
    </div>
  </header>

  <main>
    <div id="wallet-connect"></div>
    <div id="status" class="connected" style="display:none;"></div>

    <section id="send">
      <h2>Send SUI</h2>
      <input id="to-address" placeholder="Recipient Sui Address (0x...)">
      <input id="amount" type="number" step="0.001" placeholder="Amount in SUI">
      <button id="send-btn">Send Payment</button>
    </section>

    <section id="request">
      <h2>Request Payment</h2>
      <input id="request-amount" type="number" step="0.001" placeholder="Amount to request (SUI)">
      <div id="share-link" class="share-link" style="display:none;"></div>
    </section>

    <section id="split">
      <h2>Bill Splitter</h2>
      <input id="bill-total" type="number" step="0.001" placeholder="Total Bill Amount (SUI)">
      <input id="num-people" type="number" placeholder="Number of People">
      <p id="split-result" style="font-weight:bold; margin-top:15px; color:#86efac;"></p>
    </section>

    <div class="powered-by">
      Powered by
      <img src="https://cryptologos.cc/logos/sui-sui-logo.png" alt="Sui Logo">
      <span>Sui Blockchain</span>
    </div>
  </main>

  <footer>
    Made for Sui Campus Hackathon â€¢ Instant, low-cost payments for Nigerian students ðŸ’¸
  </footer>

  <script type="module">
    import { WalletKitProvider, ConnectButton, useWalletKit } from '@mysten/wallet-kit';

    // Render Connect Button
    const walletDiv = document.getElementById('wallet-connect');
    const connectButton = document.createElement('div');
    walletDiv.appendChild(connectButton);

    customElements.define('connect-button-wrapper', class extends HTMLElement {
      connectedCallback() {
        this.innerHTML = '';
        const root = ReactDOM.createRoot(this);
        root.render(React.createElement(ConnectButton));
      }
    });

    connectButton.innerHTML = '<connect-button-wrapper></connect-button-wrapper>';

    // Wallet logic
    const { currentWallet, connected, currentAccount, signAndExecuteTransactionBlock } = useWalletKit();

    const statusEl = document.getElementById('status');
    const sendBtn = document.getElementById('send-btn');

    function updateStatus() {
      if (connected.value && currentAccount.value) {
        statusEl.textContent = `Connected: ${currentAccount.value.address.slice(0,6)}...${currentAccount.value.address.slice(-4)}`;
        statusEl.style.display = 'block';
      } else {
        statusEl.style.display = 'none';
      }
    }

    connected.subscribe(updateStatus);
    currentAccount.subscribe(updateStatus);

    // Send SUI
    sendBtn.addEventListener('click', async () => {
      if (!connected.value) return alert('Connect your Sui wallet first!');
      const to = document.getElementById('to-address').value.trim();
      const amt = document.getElementById('amount').value;
      if (!to || !amt || amt <= 0) return alert('Enter valid address and amount');

      const tx = new TransactionBlock();
      const [coin] = tx.splitCoins(tx.gas, [tx.pure.u64(BigInt(Math.floor(amt * 1_000_000_000)))]);
      tx.transferObjects([coin], to);

      try {
        await signAndExecuteTransactionBlock({ transactionBlock: tx, network: 'testnet' });
        alert('Payment sent successfully! ðŸš€');
      } catch (e) {
        alert('Error: ' + (e.message || e));
      }
    });

    // Request Payment Link
    document.getElementById('request-amount').addEventListener('input', () => {
      const amt = document.getElementById('request-amount').value;
      const linkEl = document.getElementById('share-link');
      if (amt > 0 && currentAccount.value) {
        const url = `${window.location.href}?pay=${currentAccount.value.address}&amount=${amt}`;
        linkEl.innerHTML = `Share this link:<br><a href="${url}" style="color:#0ea5e9;">${url}</a>`;
        linkEl.style.display = 'block';
      } else {
        linkEl.style.display = 'none';
      }
    });

    // Bill Splitter
    const calculateSplit = () => {
      const total = parseFloat(document.getElementById('bill-total').value);
      const people = parseInt(document.getElementById('num-people').value);
      const result = document.getElementById('split-result');
      if (total > 0 && people > 1) {
        result.textContent = `Each person pays: ${(total / people).toFixed(4)} SUI`;
      } else {
        result.textContent = '';
      }
    };
    document.getElementById('bill-total').addEventListener('input', calculateSplit);
    document.getElementById('num-people').addEventListener('input', calculateSplit);
  </script>
</body>
</html>