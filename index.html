<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Universal EVM Wallet Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://unpkg.com/@walletconnect/modal@2.6.2/dist/umd/index.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  body{font-family:'Inter',sans-serif;background:#0f0f1a;color:#e0e0ff;margin:0;padding:0;}
  .container{max-width:800px;margin:40px auto;padding:20px;}
  .card{background:#1a1a2e;border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 10px 30px rgba(0,0,0,0.5);}
  h1{color:#7c3aed;text-align:center;margin-bottom:30px;}
  button{background:#7c3aed;color:white;border:none;padding:14px 32px;border-radius:12px;font-size:18px;cursor:pointer;width:100%;font-weight:600;}
  button:hover{background:#5b21b6;}
  .addr{font-family:monospace;background:#16213e;padding:12px;border-radius:10px;margin:15px 0;word-break:break-all;font-size:15px;}
  .balance{font-size:24px;font-weight:700;margin:10px 0;color:#a78bfa;}
  .chain{display:inline-block;background:#16213e;padding:6px 14px;border-radius:50px;font-size:14px;margin-bottom:15px;}
  table{width:100%;border-collapse:collapse;margin-top:15px;}
  th,td{padding:12px;text-align:left;border-bottom:1px solid #2a2a3e;}
  th{color:#a78bfa;}
  .tx-amount{color:#34d399;font-weight:600;}
  .tx-in{color:#34d399;}
  .tx-out{color:#f87171;}
  .time{color:#94a3b8;font-size:13px;}
  .loading{text-align:center;padding:40px;color:#64748b;}
</style>
</head>
<body>

<div class="container">
  <h1>Universal EVM Wallet Explorer</h1>

  <div class="card">
    <button id="connectBtn">Connect Wallet</button>
    <div id="walletInfo" style="display:none;margin-top:20px;">
      <div class="chain" id="chainInfo">Chain</div>
      <div class="addr" id="address">0x...</div>
      <div class="balance" id="nativeBalance">0 ETH</div>
      <div class="balance" id="usdcBalance">0 USDC</div>
    </div>
  </div>

  <div class="card" id="txCard" style="display:none;">
    <h2 style="margin-top:0;color:#a78bfa;">Last 10 Transactions</h2>
    <div id="txList"><div class="loading">Connect wallet to load transactions...</div></div>
  </div>
</div>

<script>
// USDC addresses on major chains (add more if you want)
const USDC_ADDRESSES = {
  1: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",      // Ethereum
  8453: "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",    // Base
  42161: "0xaf88d065e77c8cC2239327C5EDb3A432268e5831",   // Arbitrum
  10: "0x0b2C639c533813f4Aa9D7837CAf62653d097Ff85",      // Optimism
  137: "0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359",     // Polygon
  56: "0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d",      // BSC
  43114: "0xB97EF9Ef8734c71904D8002F8b6F7A8fA9F6C9B7"     // Avalanche
};

let web3, account, chainId;

async function connectWallet() {
  if (window.ethereum) {
    web3 = new Web3(window.ethereum);
    try {
      await ethereum.request({ method: 'eth_requestAccounts' });
      await loadWallet();
    } catch (e) { alert("User rejected request"); }
  } else {
    // WalletConnect fallback
    const modal = new WalletConnect.Modal({
      projectId: 'YOUR_PROJECT_ID', // optional, works without
      chains: [1]
    });
    const session = await modal.connect();
    web3 = new Web3(new Web3.providers.HttpProvider("https://eth.llamarpc.com"));
    account = session.accounts[0];
    await loadWallet();
  }
}

async function loadWallet() {
  [account] = await web3.eth.getAccounts();
  chainId = await web3.eth.getChainId();

  document.getElementById('address').textContent = account;
  document.getElementById('chainInfo').textContent = getChainName(chainId);
  document.getElementById('walletInfo').style.display = 'block';
  document.getElementById('connectBtn').textContent = "Reconnect / Change Wallet";

  await updateBalances();
  await loadTransactions();
  
  // Listen for chain/account changes
  ethereum.on('chainChanged', () => location.reload());
  ethereum.on('accountsChanged', () => location.reload());
}

async function updateBalances() {
  const native = await web3.eth.getBalance(account);
  const nativeFormatted = (native / 1e18).toFixed(4);
  document.getElementById('nativeBalance').textContent = `${nativeFormatted} ${getChainName(chainId).split(' ')[0]}`;

  const usdcAddr = USDC_ADDRESSES[chainId];
  if (usdcAddr) {
    const usdc = new web3.eth.Contract([{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"}], usdcAddr);
    const bal = await usdc.methods.balanceOf(account).call();
    const dec = await usdc.methods.decimals().call();
    document.getElementById('usdcBalance').textContent = `${(bal / (10**dec)).toFixed(2)} USDC`;
  } else {
    document.getElementById('usdcBalance').textContent = "— USDC (chain not supported)";
  }
}

async function loadTransactions() {
  document.getElementById('txCard').style.display = 'block';
  document.getElementById('txList').innerHTML = '<div class="loading">Loading transactions...</div>';

  const apiKey = ""; // Optional: get free key from etherscan/basescan/etc for higher rate limits
  let apiUrl;

  if (chainId === 8453) apiUrl = `https://api.basescan.org/api`;
  else if (chainId === 42161) apiUrl = `https://api.arbiscan.io/api`;
  else if (chainId === 10) apiUrl = `https://api-optimistic.etherscan.io/api`;
  else if ([137,56,43114].includes(chainId)) apiUrl = `https://api.routescan.io/v2/network/${chainId}/evm}/address/${account}/transactions`;
  else apiUrl = `https://api.etherscan.io/api`; // fallback

  try {
    const resp = await fetch(`${apiUrl}?module=account&action=txlist&address=${account}&sort=desc&apikey=${apiKey}`);
    const data = await resp.json();

    if (data.status !== "1") throw "API error";

    const txs = data.result.slice(0, 10);
    let html = '<table><tr><th>Time</th><th>Hash</th><th>Amount</th><th>To/From</th></tr>';

    for (let tx of txs) {
      const time = new Date(tx.timeStamp * 1000).toLocaleString();
      const hash = tx.hash.slice(0,10) + '...' + tx.hash.slice(-8);
      const value = (tx.value / 1e18).toFixed(6);
      const direction = tx.from.toLowerCase() === account.toLowerCase() ? "tx-out" : "tx-in";
      const arrow = direction === "tx-out" ? "→" : "←";
      const amountClass = direction === "tx-out" ? "tx-out" : "tx-in";

      html += `<tr>
        <td class="time">${timeAgo(tx.timeStamp)}</td>
        <td><a href="${getExplorer(chainId)}tx/${tx.hash}" target="_blank">${hash}</a></td>
        <td class="${amountClass} tx-amount">${arrow} ${value}</td>
        <td>${direction === "tx-out" ? "You sent" : "You received"}</td>
      </tr>`;
    }
    html += '</table>';
    document.getElementById('txList').innerHTML = html;
  } catch (e) {
    document.getElementById('txList').innerHTML = `<div style="color:#f87171">Could not load txs on this chain (rate limit or unsupported)</div>`;
  }
}

function timeAgo(timestamp) {
  const seconds = Math.floor((Date.now() / 1000) - timestamp);
  let interval = Math.floor(seconds / 31536000);
  if (interval > 1) return interval + "y ago";
  interval = Math.floor(seconds / 2592000);
  if (interval > 1) return interval + "mo ago";
  interval = Math.floor(seconds / 86400);
  if (interval > 1) return interval + "d ago";
  interval = Math.floor(seconds / 3600);
  if (interval > 1) return interval + "h ago";
  interval = Math.floor(seconds / 60);
  if (interval > 1) return interval + "m ago";
  return Math.floor(seconds) + "s ago";
}

function getChainName(id) {
  const names = {1:"Ethereum",8453:"Base",42161:"Arbitrum",10:"Optimism",137:"Polygon",56:"BSC",43114:"Avalanche"};
  return names[id] || `Chain ${id}`;
}

function getExplorer(id) {
  const explorers = {
    1: "https://etherscan.io/",
    8453: "https://basescan.org/",
    42161: "https://arbiscan.io/",
    10: "https://optimistic.etherscan.io/",
    137: "https://polygonscan.com/",
    56: "https://bscscan.com/",
    43114: "https://snowtrace.io/"
  };
  return explorers[id] || "https://etherscan.io/";
}

document.getElementById('connectBtn').onclick = connectWallet;
</script>
</body>
</html>